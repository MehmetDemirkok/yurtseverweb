generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Company {
  id                 Int                 @id @default(autoincrement())
  name               String
  email              String              @unique
  phone              String?
  address            String?
  city               String?
  country            String              @default("Türkiye")
  taxNumber          String?
  taxOffice          String?
  logo               String?
  status             CompanyStatus       @default(ACTIVE)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  arventoApiKey      String?
  arventoBaseUrl     String?             @default("https://api.arvento.com")
  arventoIsConnected Boolean             @default(false)
  arventoLastTest    DateTime?
  plan               CompanyPlan         @default(FREE)
  planExpiresAt      DateTime?
  freeLimitReached   Boolean             @default(false)
  accommodations     Accommodation[]
  accommodationSales AccommodationSale[]
  hotels             Hotel[]
  logs               Log[]
  organizations      Organization[]
  payments                Payment[]
  users                   User[]
  financialTransactions   FinancialTransaction[]
}

model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  name        String?
  createdAt   DateTime @default(now())
  password    String
  role        Role     @default(SIRKET_YONETICISI)
  permissions String[] @default([])
  companyId   Int
  logs        Log[]
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  financialTransactions FinancialTransaction[]

  @@unique([email, companyId])
}

model Organization {
  id              Int                @id @default(autoincrement())
  name            String
  description     String?
  contactPerson   String?
  contactEmail    String?
  contactPhone    String?
  status          OrganizationStatus @default(ACTIVE)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  companyId       Int
  baslangicTarihi DateTime?
  bitisTarihi     DateTime?
  hotelId         Int?
  lokasyon        String?
  sehir           String?
  ulke            String?
  accommodations  Accommodation[]
  company         Company            @relation(fields: [companyId], references: [id], onDelete: Cascade)
  hotel           Hotel?             @relation(fields: [hotelId], references: [id])

  @@unique([name, companyId])
}

model Accommodation {
  id              Int                 @id @default(autoincrement())
  adiSoyadi       String
  unvani          String
  ulke            String
  sehir           String
  girisTarihi     String
  cikisTarihi     String
  odaTipi         String
  konaklamaTipi   String
  gecelikUcret    Float
  toplamUcret     Float
  organizasyonAdi String?
  otelAdi         String?
  kurumCari       String?
  numberOfNights  Int?
  companyId       Int
  isMunferit      Boolean             @default(false)
  organizationId  Int?
  createdAt       DateTime            @default(now())
  isTransferred   Boolean             @default(false)
  updatedAt       DateTime            @updatedAt
  company         Company             @relation(fields: [companyId], references: [id], onDelete: Cascade)
  organization    Organization?       @relation(fields: [organizationId], references: [id])
  sales           AccommodationSale[]
}

model AccommodationSale {
  id                Int               @id @default(autoincrement())
  accommodationId   Int
  adiSoyadi         String
  unvani            String
  ulke              String
  sehir             String
  girisTarihi       String
  cikisTarihi       String
  odaTipi           String
  konaklamaTipi     String
  otelAdi           String?
  alisFiyati        Float
  toplamAlisFiyati  Float
  satisFiyati       Float             @default(0)
  toplamSatisFiyati Float             @default(0)
  kar               Float             @default(0)
  karOrani          Float             @default(0)
  musteriAdi        String?
  musteriCariKodu   String?
  faturaDurumu      SaleFaturaStatus  @default(BEKLIYOR)
  odemeDurumu       SalePaymentStatus @default(ODENMEDI)
  notlar            String?
  odenenTutar       Float             @default(0)
  kalanTutar        Float             @default(0)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  companyId         Int
  accommodation     Accommodation     @relation(fields: [accommodationId], references: [id], onDelete: Cascade)
  company           Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
}

model Hotel {
  id            Int            @id @default(autoincrement())
  adi           String
  adres         String
  sehir         String
  ulke          String
  telefon       String?
  email         String?
  website       String?
  yildizSayisi  Int            @default(0)
  puan          Float          @default(0.0)
  aciklama      String?
  durum         HotelDurum     @default(AKTIF)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  companyId     Int
  company       Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  organizations Organization[]
}

model Payment {
  id            Int           @id @default(autoincrement())
  companyId     Int
  amount        Float
  currency      String        @default("USD")
  plan          CompanyPlan
  status        PaymentStatus @default(PENDING)
  paymentMethod String?
  transactionId String?
  notes         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  paidAt        DateTime?
  company       Company       @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
  @@index([status])
}

model Log {
  id         Int      @id @default(autoincrement())
  action     String
  modelName  String
  recordId   Int
  recordData String
  userId     Int?
  createdAt  DateTime @default(now())
  ipAddress  String?
  userAgent  String?
  companyId  Int
  company    Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user       User?    @relation(fields: [userId], references: [id])
}

enum CompanyStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum Role {
  ADMIN
  SIRKET_YONETICISI
}

enum HotelDurum {
  AKTIF
  PASIF
  TAMAMEN_DOLU
  BAKIM
}

enum OrganizationStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum SaleFaturaStatus {
  BEKLIYOR
  KESILDI
  IPTAL
}

enum SalePaymentStatus {
  ODENMEDI
  KISMI_ODENDI
  ODENDI
}

enum CompanyPlan {
  FREE
  PRO
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum FinancialTransactionType {
  GELIR
  GIDER
}

enum FinancialTransactionCategory {
  KONAKLAMA
  TRANSFER
  OFIS_GIDERLERI
  TEDARIKCI_ODEMESI
  MAAŞ
  VERGI
  DİĞER
}

model FinancialTransaction {
  id          Int                        @id @default(autoincrement())
  type        FinancialTransactionType
  category    FinancialTransactionCategory
  description String
  amount      Float
  date        DateTime
  companyId   Int
  userId      Int?
  notes       String?
  createdAt   DateTime                   @default(now())
  updatedAt   DateTime                   @updatedAt

  company     Company                    @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user        User?                      @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([companyId])
  @@index([date])
  @@index([type])
}
